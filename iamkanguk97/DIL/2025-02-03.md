# 챕터6) 메모리와 캐시 메모리

## 6-1) RAM의 특징과 종류

> - 주기억장치의 종류에는 크게 RAM과 ROM이 있음.
> - 메모리 라는 용어는 RAM을 지칭하는 경우가 많다.

## RAM의 특징

- RAM에는 실행할 프로그램의 명령어와 데이터가 저장됨.
- RAM은 전원을 끄면 저장된 내용이 사라지는 `휘발성 저장 장치`!
- 하드디스크, SSD 등의 저장 장치는 `비휘발성 저장 장치`! (전원이 꺼져도 내용이 유지됨)

**참고로 CPU는 보조기억장치에 직접 접근하지 못한다. 그래서 보조기억장치인 비휘발성 저장 장치에는 보관할 대상을 저장하고, 휘발성 저장 장치에는 실행할 대상을 저장한다.** 그래서 CPU가 실행하고 싶은 프로그램이 보조기억장치에 있다면 RAM으로 복사해서 저장하고 실행한다.

## RAM의 용량과 성능

- CPU가 실행하고자 하는 프로그램이 보조기억장치에 있음 -> RAM으로 가져와야함
- 그런데 RAM 용량이 작으면? 계속 여러번 왔다갔다 해야함.
- 하지만 용량이 크면 보조기억장치에서 많은 데이터를 가져와서 미리 RAM에 저장할 수 있음.
- **보조기억장치 = 책이 꽂혀있는 책장, RAM = 책을 읽을 수 있는 책상**

## RAM의 종류

### DRAM (Dynamic RAM)

- 시간이 지나면 저장된 데이터가 점차 사라지는 RAM
- 그래서 데이터의 소멸을 막기 위해 일정 주기로 데이터를 다시 저장해야 함
- **이런 단점이 있는데 일반적으로 사용하는 RAM이 DRAM이다.**
- **소비 전력이 낮고, 저렴하고, 집적도(밀도)가 높기 때문에 대용량으로 설계하기가 좋다.**

### SRAM (Static RAM)

- 저장된 데이터가 변하지 않는 RAM
- 시간이 지나도 저장된 데이터가 사라지지 않음
- DRAM 보다 일반적으로 속도가 빠름
- 하지만, DRAM보다 집적도가 낮고, 소비 전력이 크고 가격이 비쌈.
- **그래서, 대용량으로 만들어질 필요가 없지만 속도가 빨라야 하는 저장 장치 = 캐시 메모리에 주로 사용된다.**

### SDRAM (Snychronous Dynamic RAM)

- 클럭 신호와 동기화된, 발전된 형태의 DAM
- **클럭 타이밍에 맞춰 CPU와 정보를 주고받을 수 있음 = 클럭에 맞춰 동작하며 클럭마다 CPU와 정보를 주고받을 수 있는 DRAM**

### DDR SDRAM (Double Data Rate SDRAM)

- 최근에 가장 흔히 사용되는 RAM
- 대역폭을 넓혀 속도를 빠르게 만든 SDRAM (대역폭: 데이터를 주고받는 길의 너비)
- SDRAM은 한 클럭에 하나씩 정보를 주고받을 수 있음. 하지만 DDR SDRAM은 너비가 두 배인 도로임.
- 그래서 전송 속도가 2배 가량 빠름.
- DDR2 SDRAM은 DDR SDRAM 보다 대역폭이 2배 넓은 SDRAM.

<br/>

## 6-2) 메모리의 주소 공간

> - 물리주소: 메모리 하드웨어가 사용하는 주소
> - 논리주소: CPU와 실행중인 프로그램이 사용하는 주소 (0번지부터 시작되는 주소)

## 물리주소와 논리주소

> - CPU와 실행중인 프로그램은 현재 메모리 몇 번지에 무엇이 저장되어 있는지 모른다.
> - 메모리에 저장된 정보는 시시각각 변하기 때문이다.

### 물리주소와 논리주소 간의 변환

- CPU가 이해하는 주소가 논리주소이지만 CPU가 메모리와 상호작용하려면 논리주소와 물리주소 간의 변환이 이루어져야 한다.
- CPU와 주소 버스 사이에 위치한 `메모리 관리 장치(MMU)` 라는 하드웨어에 의해 수행된다.
- **CPU가 발생시킨 논리주소에 베이스 레지스터 값을 더해서 논리주소를 물리 주소로 변환한다.**
- `베이스 레지스터`에는 **프로그램의 가장 작은 물리주소, 즉 프로그램의 첫 물리 주소를 저장함.**
- `논리 주소`는 **프로그램의 시작점으로부터 떨어진 거리**

## 메모리 보호 기법

> - 한계 레지스터 (Limit Register)

- 한계 레지스터는 논리 주소의 최대 크기를 저장한다.
- 즉, 프로그램의 물리 주소 범위는 베이스 레지스터 값 이상, 베이스 레지스터 + 한계 레지스터 값 미만이 된다.

<br/>

## 6-3) 캐시 메모리

> - CPU가 메모리에 접근하는 시간은 CPU 연산 속도보다 느리다.
> - CPU와 가까운 저장 장치는 빠르고, 멀리 있는 저장 장치는 느림.
> - 속도가 빠른 저장 장치는 저장 용량이 작고 비싸다.

## 저장 장치 계층 구조 (Memory Hierarchy)

레지스터<br/>
캐시메모리<br/>
메모리<br/>
보조기억장치<br/>

## 캐시 메모리

- CPU와 메모리 사이에 위치함.
- 레지스터보다 용량이 크고 메모리보다 빠른 SRAM 기반의 저장장치
- CPu의 연산 속도와 메모리 접근 속도의 차이를 조금이나마 줄이기 위한 장치
- **CPU가 매번 메모리에 왔다갔다 하는건 시간이 걸리니까 메모리에서 CPU가 사용할 일부 데이터를 미리 캐시 메모리로 가져와서 쓰자.**

### 캐시 메모리의 종류

> - CPU와 가까운 순서대로 계층을 구성함

- 코어와 가장 가까운 캐시 메모리를 L1 캐시
- 그 다음 가까운 캐시 메모리를 L2, 그 다음 가까운 캐시 메모리를 L3 캐시
- L1과 L2는 코어 내부에, L3는 코어 외부에 있음.

## 참조 지역성 원리

> - 캐시 메모리는 메모리보다 용량이 적음
> - 메모리의 모든 내용을 저장할 수 없음

### 캐시 메모리에는 무엇을 저장할까?

> - **CPU가 자주 사용할 법한 내용을 예측해서 저장함.**
> - **CPU가 실제로 사용을 했을 경우 Cache hit, 사용하지 않아서 직접 가져와야 하는 경우에는 Cache Miss**

- **CPU는 최근에 접근했던 메모리 공간에 다시 접근하려는 경향이 있음.**
- **CPU는 접근한 메모리 공간 근처를 접근하려는 경향이 있음.**

위와 같은 케이스로 Cache hit의 확률을 높임.
