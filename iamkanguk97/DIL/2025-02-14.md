## 모니터

세마포의 단점으론 매번 앞뒤로 일일이 wait과 signal을 명시하는 것은 번거로운 일이다.<br/>
그리고, 잘못된 코드 작성으로 인해 기대하지 못하는 결과값을 받을 수 있다.<br/>
예를 들면, wait/signal을 명시를 안해줬던가, wait과 signal을 중복해서 사용하는 경우 등이 있을 수 있다.

이러한 문제점을 해결하기 위해서 모니터라는 `동기화` 도구가 탄생했다.

모니터를 통해 공유 자원에 접근하고자 하는 프로세스를 큐에 삽입하고, 큐에 삽입된 순서대로 하나씩 공유 자원을 이용하도록 한다.
모니터는 공유 자원을 다루는 인터페이스에 접근하기 위한 큐를 만들고, 모니터 안에 항상 하나의 프로세스만 들어오도록 해서 상호 배제를 위한 동기화를 제공한다.

### 모니터에서의 조건변수

> `조건변수(condition variable)`: 프로세스나 스레드의 실행 순서를 제어하기 위해 사용하는 특별한 변수

조건변수로 wait과 signal 연산을 수행할 수 있다. wait는 호출한 프로세스의 상태를 대기 상태로 전환하고 일시적으로 조건 변수에 대한 대기 큐에 삽입하는 연산이다.

<br/>

## 교착 상태

프로세스를 실행하기 위해서는 자원이 필요한데, 두 개 이상의 프로세스가 각자 가지고 있는 자원을 무작정 기다린다면 그 어떤 프로세스도 더 이상 진행할 수 없는 교착상태가 된다.

## 식사하는 철학자 문제 (dining philosophers problem)

일어나지 않을 사건을 기다리면서 진행이 멈춰버리는 상태를 `교착 상태(DeadLock)` 이라고 한다.

-   `철학자`는 `프로세스 혹은 스레드`, `포크`는 `자원`, `생각하는 행위`는 `자원을 기다리는 것`에 비유를 할 수 있다.
-   그리고, 포크는 한 번에 하나의 프로세스 혹은 스레드만 접근할 수 있기 때문에 `임계 구역(Critical Section)` 이라고 볼 수 있다.

## 뮤텍스 락에서의 교착 상태

-   프로세스A가 임계구역 진입 전 Lock1을 설정하고, 프로세스B도 임계구역 진입 전 Lock2를 설정했음.
-   그런데 실행 도중 프로세스A는 Lock2가 False 되기를 기다리고, 프로세스B도 Lock1이 False 되기를 기다린다고 가정해보자.
-   그러면 두 프로세스는 어떤 동작을 할까? -> 하염없이 Lock이 해제될 때까지 기다릴 것이다.

이런 교착상태를 해결하기 위해서는 교착 상태가 발생했을 때의 상황을 정확히 표현해보고, 교착 상태가 일어나는 근본적인 이유를 알아내야 한다.

<br/>

## 교착 상태 발생 조건

교착 상태가 발생할 조건에는 크게 4가지가 있다.

-   상호 배제 (Mutual Exclusion)
-   점유와 대기 (Hold and Wait)
-   비선점 (No Preemption)
-   환형 대기 (Circular Wait)

### 상호 배제 (Mutual Exclusion)

-   교착 상태가 발생한 근본적인 원인은 해당 자원을 한 번에 하나의 프로세스만 이용 가능했기 때문이다.
-   한 프로세스가 사용하는 자원을 다른 프로세스가 사용할 수 없을 때(상호 배제)에 교착 상태가 발생할 수 있다.

### 점유와 대기 (Hold and Wait)

-   왼쪽 포크를 들고 다른 철학자의 포크를 기다렸음.
-   **자원을 보유한 채 다른 자원을 기다렸기 때문에 문제가 발생했음.**
-   프로세스도 마찬가지로 어떠한 자원을 할당받은 상태에서 다른 자원을 할당받기를 기다린다면 교착 상태가 발생할 수 있음.
-   이와 같은 상황을 의미한다.

### 비선점 (Non-Preemptive)

-   만약, 철학자들 중 누군가가 다른 철학자의 포크를 뺏을 수 있다면 교착 상태는 발생하지 않을 것이다.
-   **프로세스가 자원을 비선점 하고 있었기 때문에 교착상태가 발생하는 것이다.**
-   비선점 자원은 그 자원을 이용하는 프로세스의 작업이 끝나야만 비로소 이용할 수 있다.
-   즉, 어떤 프로세스도 다른 프로세스의 자원을 강제로 빼앗지 못했기 때문에 교착 상태가 발생한 것이다.

### 원형 대기 (Circular Wait)

-   **프로세스들과 프로세스가 요청 및 할당받은 자원이 원의 형태를 이루었기 때문에 교착상태가 발생했다는 것이다.**
