# 4-3) 명령어 사이클과 인터럽트

> -   `명령어 사이클`: CPU가 하나의 명령어를 처리하는 과정에서는 어떤 정해진 흐름이 있고, 그 흐름을 반복하면서 명령어들을 처리해간다.
> -   `인터럽트`: CPU가 반복하는 중에 흐름이 끊어지는 상황이 발생하는 것

## 명령어 사이클

-   명령어를 메모리에서 CPU로 가져와야 한다 (인출 사이클 - fetch cycle)
-   CPU로 명령어 인출 후 실행 (실행 사이클 - execution cycle)
    -   제어장치가 명령어 레지스터에 담긴 값을 해석하고 제어 신호를 발생시키는 단계
-   `간접 주소 지정 방식`과 같이 오퍼랜드 필드에 유효 주소의 주소를 명시한 경우 인출 사이클을 통해 CPU로 명령어를 가져왔지만 바로 실행 사이클에 도입할 수 없다.
    -   명령어를 실행하기 위해서는 한번 더 메모리 접근을 해야하기 때문이다.
    -   이 단계를 `간접 사이클(indirect cycle)` 이라고 한다.

## 인터럽트 (Interrupt)

> -   인터럽트는 크게 동기 인터럽트와 비동기 인터럽트가 있다.

### 동기 인터럽트 (Synchronous Interrupt) - 예외

> -   CPU에 의해 발생하는 인터럽트
> -   CPU가 실행하는 프로그래밍상의 오류와 같은 예외적인 상황에 마주쳤을 때 발생하는 인터럽트
> -   동기 인터럽트는 `예외(exception)` 이라고 말한다.

### 비동기 인터럽트 (Asynchronous Interrupt) - 하드웨어 인터럽트

> -   주로 입출력장치에 의해 발생하는 인터럽트
> -   세탁기 완료, 전자레인지 조리 완료와 같은 알림 역할
> -   키보드, 마우스와 같은 입출력장치가 어떤 입력을 받아들였을 때 이를 처리하기 위해 CPU에 입력 알림(인터럽트)를 보낸다.
> -   지금 키보드를 치고 있는 이 상황에서도 비동기 인터럽트가 발생하고 있는 것!

### 하드웨어 인터럽트

> 알림과 같은 인터럽트

CPU는 입출력 작업 도중에도 효율적으로 명령어를 처리하기 위해 알림과 같은 하드웨어 인터럽트를 사용한다.

```
1. CPU가 프린터에 출력을 명령했음
2. 입출력장치는 기본적으로 CPU보다 속도가 현저히 느리기 때문에 CPU가 작업결과를 바로 받아볼 수 없음.
3. 만약 하드웨어 인터럽트를 사용하지 않는다면 CPU는 프린터가 언제 작업을 끝낼지 모르기 때문에 주기적으로 완료 여부를 확인해야 한다.
4. 그러면 CPU가 다른 생산적인 일을 할 수 없어서 CPU 사이클 낭비이다. (전자레인지 앞에서 서성거리기)
```

그래서 하드웨어 인터럽트를 사용해서 더욱 효율적으로 작업을 할 수 있음.

#### 하드웨어 인터럽트 처리 순서

> -   (1) 입출력장치는 CPU에 `인터럽트 요청 신호`를 보냄
> -   (2) CPU는 실행 사이클이 끝나고 명령어를 인출하기 전에 항상 인터럽트 여부를 확인함.
> -   (3) CPU가 인터럽트 요청을 확인하고 `인터럽트 플래그`를 통해 현재 인터럽트를 받아들일 수 있는지 여부를 확인.
> -   (4) 인터럽트를 받아들일 수 있으면 CPU는 지금까지의 작업을 백업함.
> -   (5) CPU는 `인터럽트 벡터`를 참조해서 `인터럽트 서비스 루틴`을 실행함.
> -   (6) 인터럽트 서비스 루틴 실행이 끝나면 4번에서 백업해 둔 작업을 복구해서 실행 재개.

인터럽트 요청 신호: CPU에게 인터럽트 해도 되는지 물어보는 신호<br/>
이 때 CPU가 인터럽트를 수용하기 위해서는 플래그 레지스터의 인터럽트 플래그가 활성화 되어있어야 함.<br/>
인터럽트 플래그: 하드웨어 인터럽트를 받아들일지 무시할지를 결정하는 플래그<br/>

인터럽트 플래그가 불가능으로 설정되어 있어도 무시할 수 있는 인터럽트 요청도 있음. 정전이나 하드웨어 고장으로 인한 인터럽트 등.
(막을 수 있는 인터럽트와 막을 수 없는 인터럽트)

CPU가 인터럽트 요청을 받아들이게 되면 `인터럽트 서비스 루틴(인터럽트 핸들러)` 이라는 프로그램을 실행함. 이는 `인터럽트 처리를 위한 프로그램`이다.
**메모리에 여러 개의 인터럽트 서비스 루틴이 저장되어 있음.** 이게 인터럽트가 발생하면 어떻게 행동해야 할지 알려주는 프로그램ㄹ이다.

이런 여러개의 인터럽트 서비스 루틴을 구분하기 위해서는 `인터럽트 벡터`를 이용해야 하는 것이다.

**CPU가 인터럽트 신호를 받고 인터럽트 작업을 할 때 지금까지 했던 작업들을 백업을 해야 할 것이다. 백업은 메모리의 스택 영역에 해놓는다.**

## 정리

-   `명령어 사이클`: 하나의 명령어가 처리되는 주기. 인출/실행/간접/인터럽트 사이클로 구성되어 있음.
-   `인터럽트`: CPU의 정상적인 작업을 방해하는 신호
-   인터럽트의 종류에는 `예외`와 `하드웨어 인터럽트`가 있음.
-   `인터럽트 서비스 루틴`: 인터럽트를 처리하기 위한 동작들로 이루어진 프로그램
